<!doctype html>
<html lang="nl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Letter Race</title>
<style>
html,body{margin:0;height:100%;overflow:hidden;background:#0b0f14;font-family:system-ui}
canvas{display:block}

#ui{position:fixed;top:10px;left:10px;right:10px;display:flex;justify-content:space-between;color:#fff;font-weight:700}
.pill{background:rgba(255,255,255,.12);padding:8px 12px;border-radius:12px}

#help{position:fixed;bottom:12px;left:12px;right:12px;display:flex;justify-content:space-between}
.btn{background:rgba(255,255,255,.12);color:#fff;padding:12px 16px;border-radius:14px;font-weight:800}
</style>
</head>
<body>

<canvas id="c"></canvas>

<div id="ui">
<div class="pill">Doelletter: <span id="letter">b</span></div>
<div class="pill" id="score">Score: 0</div>
</div>

<div id="help">
<div class="btn" id="leftBtn">Links</div>
<div class="btn" id="rightBtn">Rechts</div>
</div>

<script>
const canvas=document.getElementById("c")
const ctx=canvas.getContext("2d")

function resize(){
 canvas.width=window.innerWidth
 canvas.height=window.innerHeight
}
window.addEventListener("resize",resize)
resize()

// ===== ASSETS =====
const carStraight=new Image()
const carLeft=new Image()
const carRight=new Image()

carStraight.src="./car_straight.png"
carLeft.src="./car_left.png"
carRight.src="./car_right.png"

// ===== GAME STATE =====
let running=true
let lane=1
let steer="straight"
let steerTimer=0

const letters=["b","g","v","m","z","h","k","l","s","w"]
let target="b"
let score=0

const uiLetter=document.getElementById("letter")
const uiScore=document.getElementById("score")

function newTarget(){
 target=letters[Math.floor(Math.random()*letters.length)]
 uiLetter.textContent=target
}
newTarget()

// ===== ROAD MODEL =====
const segmentLength=40
const drawDistance=200
let position=0
let speed=140

// track met vooral rechte stukken
let segments=[]
function addStraight(n){for(let i=0;i<n;i++)segments.push({curve:0})}
function addCurve(n,c){for(let i=0;i<n;i++)segments.push({curve:c})}

function buildTrack(){
 segments=[]
 addStraight(80)
 for(let i=0;i<12;i++){
  addStraight(80+Math.random()*40)
  addCurve(30,(Math.random()<0.5?-1:1)*(0.2+Math.random()*0.4))
 }
 addStraight(200)
}
buildTrack()

// ===== DRAW =====
function draw(){
 const w=canvas.width
 const h=canvas.height

 ctx.fillStyle="#0b0f14"
 ctx.fillRect(0,0,w,h)

 let baseIndex=Math.floor(position/segmentLength)
 let x=0
 let dx=0
 let maxY=h

 for(let n=drawDistance;n>0;n--){
  const seg=segments[(baseIndex+n)%segments.length]
  dx+=seg.curve
  x+=dx

  const z1=n*segmentLength
  const z2=(n+1)*segmentLength

  const scale1=300/z1
  const scale2=300/z2

  const y1=h*0.6-scale1*80
  const y2=h*0.6-scale2*80

  if(y2>=maxY)continue
  maxY=y2

  const roadW1=scale1*900
  const roadW2=scale2*900

  const x1=w/2 + x*scale1*40
  const x2=w/2 + (x+dx)*scale2*40

  ctx.fillStyle=n%2?"#141f2c":"#101923"
  ctx.beginPath()
  ctx.moveTo(x1-roadW1,y1)
  ctx.lineTo(x2-roadW2,y2)
  ctx.lineTo(x2+roadW2,y2)
  ctx.lineTo(x1+roadW1,y1)
  ctx.closePath()
  ctx.fill()

  ctx.strokeStyle="rgba(255,255,255,.4)"
  ctx.lineWidth=2
  ctx.beginPath()
  ctx.moveTo(x1,y1)
  ctx.lineTo(x2,y2)
  ctx.stroke()
 }

 // ===== CAR =====
 const carImg=steer==="left"?carLeft:steer==="right"?carRight:carStraight
 const carW=Math.min(160,w*0.25)
 const carX=w/2+(lane-1)*w*0.2
 const carY=h-carW*0.8

 if(carImg.complete){
  ctx.drawImage(carImg,carX-carW/2,carY-carW/2,carW,carW)
 }else{
  ctx.fillStyle="white"
  ctx.fillRect(carX-20,carY-20,40,40)
 }
}

// ===== UPDATE =====
function update(dt){
 position+=speed*dt
 if(position>segments.length*segmentLength)position=0

 if(steerTimer>0){
  steerTimer--
  if(steerTimer===0)steer="straight"
 }
}

// ===== LOOP =====
let last=0
function loop(t){
 const dt=(t-last)/1000
 last=t
 update(dt)
 draw()
 requestAnimationFrame(loop)
}
requestAnimationFrame(loop)

// ===== INPUT =====
function move(dir){
 const prev=lane
 lane=Math.max(0,Math.min(2,lane+dir))
 if(lane!==prev){
  steer=dir<0?"left":"right"
  steerTimer=10
 }
}
document.getElementById("leftBtn").onclick=()=>move(-1)
document.getElementById("rightBtn").onclick=()=>move(1)
window.addEventListener("pointerdown",e=>{
 const x=e.clientX/window.innerWidth
 if(x<0.4)move(-1)
 else if(x>0.6)move(1)
})
</script>
</body>
</html>