<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
<title>Letter Race</title>
<style>
  html, body { margin:0; padding:0; height:100%; overflow:hidden; background:#111; font-family: Arial, sans-serif; }
  canvas { display:block; touch-action:none; }
  #ui {
    position: absolute;
    top: 12px;
    left: 12px;
    color: #fff;
    font-size: 18px;
    background: rgba(0,0,0,0.35);
    padding: 10px 12px;
    border-radius: 12px;
    backdrop-filter: blur(4px);
  }
  #ui .row { display:flex; gap:14px; align-items:center; flex-wrap:wrap; }
  #ui .badge {
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding: 6px 10px;
    border-radius: 999px;
    background: rgba(0,0,0,0.35);
  }
  #ui .targetBox{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    width: 34px;
    height: 34px;
    border-radius: 10px;
    background: rgba(255,255,255,0.18);
    border: 2px solid rgba(255,255,255,0.35);
    font-weight: 700;
  }
</style>
</head>
<body>

<div id="ui">
  <div class="row">
    <span class="badge">Energie: <span id="energy">100</span></span>
    <span class="badge">Opdracht: <span class="targetBox" id="targetLetter">A</span></span>
    <span class="badge">Goed: <span id="score">0</span></span>
  </div>
</div>

<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resize(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

const uiEnergy = document.getElementById("energy");
const uiTarget = document.getElementById("targetLetter");
const uiScore = document.getElementById("score");

function loadImg(src){
  const img = new Image();
  img.src = src;
  return img;
}

const carStraightImg = loadImg("car_straight.png");
const carLeftImg = loadImg("car_left.png");
const carRightImg = loadImg("car_right.png");

function clamp(v,a,b){ return Math.max(a,Math.min(b,v)); }
function mod(n,m){ return ((n%m)+m)%m; }

let energy = 100;
let roadScroll = 0;
let score = 0;

const letters = "AEIOUMKSTPRLN".split("");

const state = { pointerX: canvas.width/2, pointerActive:false, lastTime:performance.now() };

const car = { x: canvas.width/2, y: canvas.height*0.78, targetX: canvas.width/2, w:140, h:90, tilt:0, speed:8, steerDx:0 };

const items = [];

let targetLetter = letters[Math.floor(Math.random()*letters.length)];
uiTarget.textContent = targetLetter;
let targetTimer = 0;

function roadWidthAt(y){
  const t = clamp(y/canvas.height,0,1);
  return canvas.width*0.30 + (canvas.width*0.90-canvas.width*0.30)*(t**1.6);
}
function roadCenterXAt(y){
  const t = clamp(y/canvas.height,0,1);
  const slow = Math.sin(roadScroll/680)*(canvas.width*0.035);
  return canvas.width/2 + slow*(1-t);
}
function roadEdgesAt(y){
  const w = roadWidthAt(y);
  const cx = roadCenterXAt(y);
  return {left:cx-w/2,right:cx+w/2,cx,w};
}
function sampleRoadPoints(step=26){
  const pts=[];
  for(let y=0;y<=canvas.height+step;y+=step){
    const e=roadEdgesAt(y);
    pts.push({y,left:e.left,right:e.right,cx:e.cx});
  }
  return pts;
}

function drawBackground(){
  const g=ctx.createLinearGradient(0,0,0,canvas.height);
  g.addColorStop(0,"#74c0ff"); g.addColorStop(.5,"#3f86d9"); g.addColorStop(1,"#1a1a1a");
  ctx.fillStyle=g; ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle="#3aa64b"; ctx.fillRect(0,0,canvas.width,canvas.height);
}

function drawRoad(){
  const pts=sampleRoadPoints();
  ctx.beginPath();
  ctx.moveTo(pts[0].left,pts[0].y);
  for(let i=1;i<pts.length;i++) ctx.lineTo(pts[i].left,pts[i].y);
  for(let i=pts.length-1;i>=0;i--) ctx.lineTo(pts[i].right,pts[i].y);
  ctx.closePath(); ctx.fillStyle="#505050"; ctx.fill();

  // perspectivische band, beneden breder
  for(let i=0;i<pts.length-1;i++){
    const p1=pts[i], p2=pts[i+1];
    const t=clamp(p1.y/canvas.height,0,1);
    const w=3 + t*18; // breder onder
    ctx.strokeStyle="rgba(255,255,255,0.2)";
    ctx.lineWidth=w;
    ctx.beginPath();
    ctx.moveTo(p1.left - w*0.6, p1.y);
    ctx.lineTo(p2.left - w*0.6, p2.y);
    ctx.stroke();

    ctx.beginPath();
    ctx.moveTo(p1.right + w*0.6, p1.y);
    ctx.lineTo(p2.right + w*0.6, p2.y);
    ctx.stroke();
  }

  ctx.strokeStyle="rgba(255,255,255,0.6)";
  ctx.lineWidth=4;
  ctx.beginPath();
  ctx.moveTo(pts[0].left+3,pts[0].y);
  for(let i=1;i<pts.length;i++) ctx.lineTo(pts[i].left+3,pts[i].y);
  ctx.stroke();

  ctx.beginPath();
  ctx.moveTo(pts[0].right-3,pts[0].y);
  for(let i=1;i<pts.length;i++) ctx.lineTo(pts[i].right-3,pts[i].y);
  ctx.stroke();

  // middenlijn
  const scroll=roadScroll%240;
  for(const p of pts){
    const t=clamp(p.y/canvas.height,0,1);
    const phase=mod(p.y-scroll,240);
    if(phase>80) continue;
    ctx.strokeStyle="rgba(255,245,190,0.65)";
    ctx.lineWidth=10+t*8;
    ctx.beginPath();
    ctx.moveTo(p.cx,p.y);
    ctx.lineTo(p.cx,p.y+26+t*44);
    ctx.stroke();
  }
}

function chooseCarSprite(){
  if(car.steerDx<-18) return carLeftImg;
  if(car.steerDx>18) return carRightImg;
  return carStraightImg;
}

function drawCar(){
  const base=Math.min(canvas.width,canvas.height);
  const carW=Math.max(144,base*0.228);
  const carH=carW*0.62;
  car.w=carW; car.h=carH;

  const img=chooseCarSprite();
  ctx.save(); ctx.translate(car.x,car.y); ctx.rotate(car.tilt*0.45);
  ctx.fillStyle="rgba(0,0,0,0.22)";
  ctx.beginPath(); ctx.ellipse(0,carH*.36,carW*.34,carH*.22,0,0,Math.PI*2); ctx.fill();
  if(img.complete && img.naturalWidth) ctx.drawImage(img,-carW/2,-carH/2,carW,carH);
  ctx.restore();
}

function drawItem(it){
  const scale=0.9+(clamp(it.y,0,canvas.height)/canvas.height)*0.55;
  const size=46*scale;
  ctx.fillStyle= it.isTarget? "rgba(170,225,255,0.95)" : "rgba(255,220,120,0.95)";
  ctx.fillRect(it.x-size/2,it.y-size/2,size,size);
  ctx.fillStyle="#111";
  ctx.font=`700 ${Math.floor(26*scale)}px Arial`;
  ctx.textAlign="center"; ctx.textBaseline="middle";
  ctx.fillText(it.letter,it.x,it.y);
}

function drawItems(){ items.forEach(drawItem); }

function clampToRoad(x,y){
  const e=roadEdgesAt(y);
  const pad=car.w*.34;
  return Math.min(e.right-pad,Math.max(e.left+pad,x));
}

function spawnLetter(){
  if(items.length>2) return; // minder tegelijk
  const e=roadEdgesAt(canvas.height*.34);
  const x=e.left+120+Math.random()*(e.w-240);
  const isTarget=Math.random()<0.3;
  items.push({x,y:-60,letter:isTarget?targetLetter:letters[Math.floor(Math.random()*letters.length)],isTarget,vy:5.2});
}

let spawnTimer=0;

function update(dt){
  energy-=0.02*dt; energy=Math.max(0,Math.min(140,energy));
  uiEnergy.textContent=Math.floor(energy);
  roadScroll+=car.speed*dt;

  car.targetX=clampToRoad(state.pointerX,car.y);
  const dx=car.targetX-car.x; car.steerDx=dx;
  car.x+=dx*(0.075*dt);
  car.tilt+=(Math.max(-.2,Math.min(.2,dx/(canvas.width*.95)))-car.tilt)*(.08*dt);

  spawnTimer+=dt;
  if(spawnTimer>120){ spawnTimer=0; spawnLetter(); }

  targetTimer+=dt/60;
  if(targetTimer>8){
    targetTimer=0;
    targetLetter=letters[Math.floor(Math.random()*letters.length)];
    uiTarget.textContent=targetLetter;
  }

  for(let i=items.length-1;i>=0;i--){
    const it=items[i];
    it.y+=it.vy*dt;
    const e=roadEdgesAt(it.y);
    it.x=clamp(it.x,e.left+90,e.right-90);

    if(Math.abs(it.x-car.x)<car.w*.36 && Math.abs(it.y-car.y)<car.h*.36){
      if(it.isTarget){ score++; uiScore.textContent=score; energy+=18; }
      else energy+=8;
      items.splice(i,1); continue;
    }
    if(it.y>canvas.height+160) items.splice(i,1);
  }
}

function draw(){
  drawBackground();
  drawRoad();
  drawItems();
  drawCar();
}

function loop(now){
  const dt=Math.min(3,(now-state.lastTime)/(1000/60));
  state.lastTime=now;
  if(energy>0) update(dt);
  draw();
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

canvas.addEventListener("mousemove",e=>state.pointerX=e.clientX);
canvas.addEventListener("touchmove",e=>state.pointerX=e.touches[0].clientX,{passive:true});
</script>
</body>
</html>