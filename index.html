<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
<title>Letter Race</title>

<style>
html, body { margin:0; padding:0; height:100%; overflow:hidden; background:#111; font-family: Arial, sans-serif; }
canvas { display:block; }

#ui{
  position:absolute; top:12px; left:12px;
  color:#fff; font-size:16px;
  background:rgba(0,0,0,.35);
  padding:10px 12px; border-radius:12px;
  backdrop-filter: blur(4px);
}

.row{ display:flex; gap:12px; flex-wrap:wrap; }
.pill{
  background:rgba(0,0,0,.28);
  padding:6px 10px;
  border-radius:999px;
}

.controls{
  margin-top:8px;
  display:grid;
  gap:6px;
}

.ctrl{
  display:grid;
  grid-template-columns:120px 1fr 60px;
  gap:8px;
  align-items:center;
}

.value{ text-align:right; font-variant-numeric: tabular-nums; }
</style>
</head>

<body>

<div id="ui">
  <div class="row">
    <span class="pill">Energie <span id="energy">100</span></span>
    <span class="pill">Letter <span id="targetLetter">a</span></span>
    <span class="pill">Tempo <span id="tempo">1.00</span></span>
  </div>

  <div class="controls">
    <div class="ctrl">
      <label>Bomen start</label>
      <input id="treeStart" type="range" min="0.05" max="2" step="0.01" value="0.22">
      <div class="value" id="treeStartVal">0.22</div>
    </div>

    <div class="ctrl">
      <label>Bomen eind</label>
      <input id="treeEnd" type="range" min="2" max="40" step="0.1" value="14">
      <div class="value" id="treeEndVal">14.0</div>
    </div>
  </div>
</div>

<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resize(){ canvas.width = innerWidth; canvas.height = innerHeight; }
addEventListener("resize", resize);
resize();

/* UI */
const uiEnergy = document.getElementById("energy");
const uiTempo  = document.getElementById("tempo");
const uiTarget = document.getElementById("targetLetter");

const treeStartSlider = document.getElementById("treeStart");
const treeEndSlider   = document.getElementById("treeEnd");
const treeStartVal    = document.getElementById("treeStartVal");
const treeEndVal      = document.getElementById("treeEndVal");

/* helpers */
function clamp(v,a,b){ return Math.max(a, Math.min(b,v)); }
function lerp(a,b,t){ return a+(b-a)*t; }
function mod(n,m){ return ((n%m)+m)%m; }

/* images */
function img(src){ const i=new Image(); i.src=src; return i; }
const carImg = img("car_straight.png");
const treeImg = img("tree.png");

/* state */
let energy=100;
let tempoFactor=1;
let roadScroll=0;

const letters="aeioumkstprln".split("");
let targetLetter=letters[Math.floor(Math.random()*letters.length)];
uiTarget.textContent=targetLetter;

const car={
 x:canvas.width/2,
 y:canvas.height*0.78,
 w:150,
 h:90
};

/* tree tuning via sliders */
let treeAccelStart=parseFloat(treeStartSlider.value);
let treeAccelEnd=parseFloat(treeEndSlider.value);

function syncTreeUI(){
 treeAccelStart=parseFloat(treeStartSlider.value);
 treeAccelEnd=parseFloat(treeEndSlider.value);
 treeStartVal.textContent=treeAccelStart.toFixed(2);
 treeEndVal.textContent=treeAccelEnd.toFixed(1);
}
treeStartSlider.oninput=syncTreeUI;
treeEndSlider.oninput=syncTreeUI;
syncTreeUI();

/* road geometry */
function roadWidthAt(y){
 const t=clamp(y/canvas.height,0,1);
 return canvas.width*0.3+(canvas.width*0.9-canvas.width*0.3)*(t**1.6);
}
function roadCenterXAt(y){
 const t=clamp(y/canvas.height,0,1);
 const bend=Math.sin(roadScroll/720)*(canvas.width*0.03);
 return canvas.width/2 + bend*(1-t);
}
function roadEdgesAt(y){
 const w=roadWidthAt(y);
 const cx=roadCenterXAt(y);
 return {left:cx-w/2,right:cx+w/2,cx,w};
}

/* trees */
const trees=[];
let treeSpawnTimer=0;

function spawnTree(){
 trees.push({
  side:Math.random()<0.5?"left":"right",
  baseY:-420,
  sizeSeed:0.9+Math.random()*0.25
 });
}

function treeX(tr){
 const e=roadEdgesAt(tr.baseY);
 const t=clamp(tr.baseY/canvas.height,0,1);
 const margin=(44+t*180);
 return tr.side==="left"?e.left-margin:e.right+margin;
}

function treeSize(tr){
 const t=clamp(tr.baseY/canvas.height,0,1);
 const p=t**1.05;
 const w=(16+p*1100)*tr.sizeSeed;
 const h=w*1.1;
 return {w,h};
}

function updateTrees(dt){
 treeSpawnTimer+=dt;
 if(treeSpawnTimer>240/tempoFactor){
  treeSpawnTimer=0;
  spawnTree();
 }

 for(let i=trees.length-1;i>=0;i--){
  const tr=trees[i];
  const t=clamp(tr.baseY/canvas.height,0,1);

  const accel=lerp(treeAccelStart,treeAccelEnd,t**1.8);
  let dy=accel*tempoFactor*dt*2.5;

  dy=Math.min(dy,120*dt*tempoFactor);
  tr.baseY+=dy;

  const h=treeSize(tr).h;
  if(tr.baseY-h>canvas.height+80) trees.splice(i,1);
 }
}

function drawTrees(){
 for(const tr of trees){
  const {w,h}=treeSize(tr);
  const x=treeX(tr);
  const y=tr.baseY-h;

  ctx.fillStyle="rgba(0,0,0,0.22)";
  ctx.beginPath();
  ctx.ellipse(x,tr.baseY+h*0.05,w*0.34,h*0.12,0,0,Math.PI*2);
  ctx.fill();

  if(treeImg.complete) ctx.drawImage(treeImg,x-w/2,y,w,h);
 }
}

/* road drawing */
function drawRoad(){
 const pts=[];
 for(let y=0;y<=canvas.height+30;y+=30){
  const e=roadEdgesAt(y);
  pts.push({y,left:e.left,right:e.right,cx:e.cx});
 }

 ctx.beginPath();
 ctx.moveTo(pts[0].left,pts[0].y);
 for(let i=1;i<pts.length;i++) ctx.lineTo(pts[i].left,pts[i].y);
 for(let i=pts.length-1;i>=0;i--) ctx.lineTo(pts[i].right,pts[i].y);
 ctx.closePath();
 ctx.fillStyle="#505050";
 ctx.fill();

 ctx.strokeStyle="rgba(255,255,255,0.6)";
 ctx.lineWidth=4;

 ctx.beginPath();
 ctx.moveTo(pts[0].left,pts[0].y);
 for(let i=1;i<pts.length;i++) ctx.lineTo(pts[i].left,pts[i].y);
 ctx.stroke();

 ctx.beginPath();
 ctx.moveTo(pts[0].right,pts[0].y);
 for(let i=1;i<pts.length;i++) ctx.lineTo(pts[i].right,pts[i].y);
 ctx.stroke();

 /* stable dashed center line using distance projection */
 const H=canvas.height;
 const scale=0.0042;

 function yFromS(s){ return H/(1+s*scale); }

 const period=260;
 const dash=105;
 const offset=(period-(roadScroll%period))%period;

 let guard=0;

 for(let s=offset;guard<200;s+=period,guard++){
  const y1=yFromS(s);
  if(y1<=0) break;
  const y2=yFromS(s+dash);

  const cx=roadCenterXAt(y1);
  const t=clamp(y1/H,0,1);
  const w=lerp(8,22,t);

  ctx.strokeStyle="rgba(255,245,190,0.8)";
  ctx.lineWidth=w;
  ctx.beginPath();
  ctx.moveTo(cx,y1);
  ctx.lineTo(cx,y2);
  ctx.stroke();
 }
}

/* draw */
function draw(){
 ctx.fillStyle="#3aa64b";
 ctx.fillRect(0,0,canvas.width,canvas.height);

 drawRoad();
 drawCar();
 drawTrees(); /* bomen boven auto */
}

function drawCar(){
 if(carImg.complete)
 ctx.drawImage(carImg,car.x-80,car.y-45,160,90);
}

/* loop */
let last=performance.now();
function loop(now){
 const dt=Math.min(3,(now-last)/(1000/60));
 last=now;

 energy=Math.max(0,energy-0.02*dt);
 uiEnergy.textContent=Math.floor(energy);

 roadScroll+=9*tempoFactor*dt;
 uiTempo.textContent=tempoFactor.toFixed(2);

 updateTrees(dt);
 draw();

 requestAnimationFrame(loop);
}
requestAnimationFrame(loop);
</script>
</body>
</html>