<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
<title>Letter Race</title>
<style>
  html, body { margin:0; padding:0; height:100%; overflow:hidden; background:#111; font-family: Arial, sans-serif; }
  canvas { display:block; touch-action:none; }

  #ui {
    position:absolute; top:12px; left:12px; color:#fff;
    font-size:18px; background:rgba(0,0,0,.35);
    padding:10px 12px; border-radius:12px;
  }

  #devMenu{
    position:absolute; bottom:20px; left:50%;
    transform:translateX(-50%);
    background:rgba(0,0,0,.6);
    color:#fff; padding:14px 18px;
    border-radius:14px;
    display:none;
    backdrop-filter: blur(6px);
  }
  #devMenu input{ width:240px; }
</style>
</head>
<body>

<div id="ui">
  Energie: <span id="energy">100</span>
</div>

<div id="devMenu">
  Tempo <input type="range" id="speedSlider" min="0.6" max="2.2" step="0.05" value="1">
</div>

<canvas id="game"></canvas>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");

function resize(){ canvas.width=innerWidth; canvas.height=innerHeight }
addEventListener("resize",resize); resize();

const uiEnergy=document.getElementById("energy");
const devMenu=document.getElementById("devMenu");
const speedSlider=document.getElementById("speedSlider");

let tempoFactor=1;
speedSlider.oninput=()=> tempoFactor=parseFloat(speedSlider.value);

document.addEventListener("keydown",e=>{
  if(e.key==="t"||e.key==="T") devMenu.style.display=devMenu.style.display==="none"?"block":"none";
});
canvas.addEventListener("touchstart",e=>{
  if(e.touches.length===3){
    devMenu.style.display=devMenu.style.display==="none"?"block":"none";
  }
},{passive:true});

function loadImg(src){ const i=new Image(); i.src=src; return i; }
const carStraight=loadImg("car_straight.png");
const carLeft=loadImg("car_left.png");
const carRight=loadImg("car_right.png");

function clamp(v,a,b){ return Math.max(a,Math.min(b,v)); }

let energy=100, roadScroll=0;

const letters="aeioumkstprln".split("");

const state={pointerX:canvas.width/2,lastTime:performance.now()};

const car={x:canvas.width/2,y:canvas.height*.78,tilt:0,steerDx:0,w:140,h:90};

const items=[];

function roadWidthAt(y){
  const t=clamp(y/canvas.height,0,1);
  return canvas.width*.3 + (canvas.width*.9-canvas.width*.3)*(t**1.6);
}
function roadCenterXAt(y){
  const t=clamp(y/canvas.height,0,1);
  const slow=Math.sin(roadScroll/680)*(canvas.width*.035);
  return canvas.width/2 + slow*(1-t);
}
function roadEdgesAt(y){
  const w=roadWidthAt(y);
  const cx=roadCenterXAt(y);
  return {left:cx-w/2,right:cx+w/2,cx};
}

function drawRoad(){
  const pts=[];
  for(let y=0;y<=canvas.height+26;y+=26){
    const e=roadEdgesAt(y);
    pts.push({y,left:e.left,right:e.right,cx:e.cx});
  }

  ctx.beginPath();
  ctx.moveTo(pts[0].left,pts[0].y);
  for(let i=1;i<pts.length;i++) ctx.lineTo(pts[i].left,pts[i].y);
  for(let i=pts.length-1;i>=0;i--) ctx.lineTo(pts[i].right,pts[i].y);
  ctx.closePath();
  ctx.fillStyle="#505050"; ctx.fill();

  for(let i=0;i<pts.length-1;i++){
    const p=pts[i],t=clamp(p.y/canvas.height,0,1);
    const w=3+t*18;
    ctx.strokeStyle="rgba(255,255,255,.2)";
    ctx.lineWidth=w;
    ctx.beginPath(); ctx.moveTo(p.left-w*.6,p.y); ctx.lineTo(pts[i+1].left-w*.6,pts[i+1].y); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(p.right+w*.6,p.y); ctx.lineTo(pts[i+1].right+w*.6,pts[i+1].y); ctx.stroke();
  }
}

function drawCar(){
  const base=Math.min(canvas.width,canvas.height);
  const w=Math.max(144,base*.228), h=w*.62;
  car.w=w; car.h=h;

  const img=car.steerDx<-18?carLeft:car.steerDx>18?carRight:carStraight;

  ctx.save();
  ctx.translate(car.x,car.y);
  ctx.rotate(car.tilt*.45);

  ctx.fillStyle="rgba(0,0,0,.22)";
  ctx.beginPath(); ctx.ellipse(0,h*.36,w*.34,h*.22,0,0,Math.PI*2); ctx.fill();

  if(img.complete) ctx.drawImage(img,-w/2,-h/2,w,h);
  ctx.restore();
}

function drawItem(it){
  const t=clamp(it.y/canvas.height,0,1);
  const size=36 + t*42; // perspectief groei

  ctx.fillStyle="rgba(255,220,120,.95)";
  ctx.fillRect(it.x-size/2,it.y-size/2,size,size);

  ctx.fillStyle="#111";
  ctx.font=`700 ${Math.floor(18 + t*24)}px Arial`;
  ctx.textAlign="center"; ctx.textBaseline="middle";
  ctx.fillText(it.letter,it.x,it.y);
}

function spawnLetter(){
  if(items.length>2) return;
  const e=roadEdgesAt(canvas.height*.3);
  const x=e.left+120+Math.random()*(e.right-e.left-240);
  items.push({x,y:-60,letter:letters[Math.floor(Math.random()*letters.length)],vy:6.5});
}

let spawnTimer=0;

function update(dt){
  energy-=0.02*dt; energy=Math.max(0,energy);
  uiEnergy.textContent=Math.floor(energy);

  roadScroll+=8*tempoFactor*dt;

  const targetX=clamp(state.pointerX,roadEdgesAt(car.y).left+car.w*.34,roadEdgesAt(car.y).right-car.w*.34);
  const dx=targetX-car.x;
  car.steerDx=dx;
  car.x+=dx*(.075*dt);
  car.tilt+=(clamp(dx/(canvas.width*.95),-.2,.2)-car.tilt)*(.08*dt);

  spawnTimer+=dt;
  if(spawnTimer>140/tempoFactor){ spawnTimer=0; spawnLetter(); }

  for(let i=items.length-1;i>=0;i--){
    const it=items[i];
    it.y+=it.vy*tempoFactor*dt;
    const e=roadEdgesAt(it.y);
    it.x=clamp(it.x,e.left+90,e.right-90);

    if(Math.abs(it.x-car.x)<car.w*.36 && Math.abs(it.y-car.y)<car.h*.36){
      energy=Math.min(140,energy+10);
      items.splice(i,1);
      continue;
    }
    if(it.y>canvas.height+120) items.splice(i,1);
  }
}

function draw(){
  ctx.fillStyle="#3aa64b"; ctx.fillRect(0,0,canvas.width,canvas.height);
  drawRoad();
  items.forEach(drawItem);
  drawCar();
}

function loop(now){
  const dt=Math.min(3,(now-state.lastTime)/(1000/60));
  state.lastTime=now;
  if(energy>0) update(dt);
  draw();
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

canvas.addEventListener("mousemove",e=>state.pointerX=e.clientX);
canvas.addEventListener("touchmove",e=>state.pointerX=e.touches[0].clientX,{passive:true});
</script>
</body>
</html>